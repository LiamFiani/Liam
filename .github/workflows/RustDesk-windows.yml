name: RustDesk Windows VM

on:
  workflow_dispatch:

jobs:
  connect:
    runs-on: windows-latest
    steps:
      - name: Set up static RustDesk ID and password
        run: |
          $configPath = "$env:APPDATA\RustDesk\config"
          New-Item -ItemType Directory -Force -Path $configPath | Out-Null

          # Set static ID and password
          "mygithubvm" | Out-File "$configPath\id" -Encoding ascii
          "123456" | Out-File "$configPath\passwd" -Encoding ascii

      - name: Download RustDesk
        run: |
          Invoke-WebRequest -Uri "https://github.com/rustdesk/rustdesk/releases/download/1.2.3/rustdesk-1.2.3-x86_64.exe" -OutFile "rustdesk.exe"

      - name: Start RustDesk silently
        run: |
          Start-Process -FilePath ".\rustdesk.exe" -WindowStyle Hidden
          Start-Sleep -Seconds 30

      - name: Show RustDesk ID and Password
        run: |
          Get-Content "$env:APPDATA\RustDesk\config\id"
          Get-Content "$env:APPDATA\RustDesk\config\passwd"
